---
layout: post
title: AWS S3
author: vgihan
description: study Amazon Web Service S3
tags: [aws, cloud, s3, bucket]
categories: [AWS]
published: true
extensions:
  preset: gfm
---

Amazon Simple Storage Service 의 약자로, SSS를 줄여서 S3라고 함. AWS의 대표적인 서비스로, 객체 스토리지의 역할을 수행한다. S3는 다음과 같은 역할을 수행한다.

- 파일 업로드, 다운로드, 검색
- 무제한 용량 (돈이 무제한으로 필요함….!)
- 다양한 인증/권한 부여 제공

### S3 용어

- **bucket**: 오브젝트(파일)를 저장하기 위한 컨테이너
  - 버킷명은 전 세계 유일하게 지정해야한다.
- **object:** 버킷은 오브젝트 저장소로, 오브젝트 = 파일이다.
  - S3 버킷의 모든 오브젝트들은 고유한 URL이 존재한다.
- **key:** 버킷안의 오브젝트를 식별하는데 사용 (Prefix + filename)
- **version:** 버저닝을 활성화하면, 파일의 버전을 저장할 수 있다.
  - ex) https://honux-inf.s3.amazonaws.com/2021-1/avartar.png?version= 과 같이 쿼리 스트링으로 버전을 추가할 수 있다.
  - 파일을 수정하면, 수정 이후의 파일만 저장하는 것이 아니라 이전 내용도 모두 저장하므로, 비용에 주의해야한다 !
  - 파일의 라이프사이클 관리가 불편해진다.
- **ACL:** Access Control List로, 각 오브젝트마다 권한을 설정할 수 있다. 주로 간단한 제어에 사용된다.
- **Bucket Policy:** IAM Policy와 유사한 문법으로, ACL보다 복잡하고 세부적으로 권한 설정이 가능하다.

### S3 특징

- 리전 기반 서비스로 데이터 센터가 분산되어 있다.
- 그렇기 때문에 굉장히 안정적임 !
- CDN과 연동 가능함
- static web page 기능을 지원한다.
- 버저닝 (Versioning) 기능을 사용할 수 있다.
  - 이름이 같은 파일을 여러 번 S3에 저장할 시, 저장될 때마다 버전을 유지할 수 있다.
- 다양한 요금 옵션으로 비용 절감이 가능하다 !

### S3 사용 예시

- 클라우드 저장소 (구글 드라이브처럼 사용 가능)
- 서비스의 대용량 파일 저장소 - 이미지, 동영상, 빅데이터 등
  - ex) 넷플릭스 같은 서비스를 만든다고 했을 때 영화들을 S3에 저장해두고 사용할 수 있음 !
- 서비스 로그 저장 및 분석
  - 서비스의 로그를 EC2 서버에 저장해두는 것은 안티 패턴임.
    - EC2의 SSD(EBS)에 저장하는 것보다, S3에 파일을 저장하는 것이 훨씬 저렴함.
    - EBS보다 S3가 훨씬 더 안정적임
  - S3에 저장해두고 사용하도록 하자 !
- 서비스 사용자의 데이터 업로드 서버
- AWS 아데나를 이용하여 빅데이터 업로드 및 분석이 가능함.
  - SQL 쿼리같은 쿼리문을 날려서 빅데이터 분석이 가능함.

### S3 권한 제어

ACL과 Bucket Policy를 이용하여 버킷의 권한을 제어할 수 있다. 또한 IAM 사용자에게 버킷 접근 권한을 주어 제어할수도 있다.

**PresignedURL:** URL을 이용하여 임시 권한을 부여하는 기능으로, 매우 유용하다 !

기본적으로 버킷의 파일들을 모두 private으로, 파일을 식별하는 URL로 접속하면 파일을 확인할 수 없다. 하지만, 권한을 public으로 변경시켜 공개적으로 사용이 가능하다.

### ACL

ACL은 버킷 내에 존재하는 파일의 접근 권한을 `파일 별로` 설정할 수 있다. 리눅스와 비슷하게 파일의 접근 권한을 [객체 소유자, 모든 사람, 인증된 사용자 그룹] 으로 분리하여 권한을 부여할 수 있다.

폴더의 ACL을 수정하여 폴더 하위에 존재하는 파일들 모두 public으로 변경하는 것은 불가능하다. 왜냐하면, `폴더` 는 ACL 설정이 불가능하기 때문.

### Bucket Policy

S3에 등록되는 파일들은 기본적으로 파일 소유자를 제외한 나머지 사용자는 접근이 불가능하기 때문에, 권한을 변경하려면 파일을 등록할 때마다 ACL을 편집해주어야 하는 불편함이 있다.

이럴 땐, Bucket Policy를 추가하여 해당 폴더 하위에 존재하는 파일들의 접근을 Policy를 통해 허용할 수 있다.

### Storage Class

S3는 용도에 맞게 다양한 타입의 Storage Class를 제공한다.

`Standard`, `Standard-IA`, `One Zone-IA`, `Glacier`등이 있다.

class에 따라 저장 방식도 약간 다르고, 요금에도 차이가 존재한다.

### Life Cycle

파일의 Life Cycle을 지정할 수 있다. 오래 지난 파일은 폐기시키는 등의 작업을 수행할 수 있고, 일정 시간이 지나면 다른 Storage Class 로 변경되는 작업도 수행할 수 있다.

### Eventual Consistency

분산 시스템에서는 CAP 이론에 의해서 일관성(Consistency), 가용성(Availability), 분할 내구성(Partition Tolerance) 3가지 중 2가지만 충족할 수 있음.

가용성을 포기하면, 분산되어있는 모든 시스템에 변경이 반영될 때까지 클라이언트는 해당 데이터에 접근 불가능.

일관성을 포기하면, 모든 시스템 중 데이터의 변경이 이루어지지 않은 시스템을 참조했을 때, 클라이언트는 변경 이전의 데이터를 참조하게 됨.

이것을 `Eventual Consistency` 라고 하는데, Eventual 하게 일관성을 보장한다는 뜻. 즉, 일관성을 보장하지 않는 경우도 존재한다는 뜻.

AWS는 원래 Eventual Consistency 였지만, 개선된 후 강력한 쓰기 후 일관성을 제공한다고 한다. (쓰기 후 바로 읽는 것이 가능하다는 것)
